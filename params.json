{"name":"Bobbytables","tagline":"A .net ORM library for the Dropbox datastore API","body":"BobbyTables\r\n===========\r\n\r\nBobbyTables is a .Net ORM library for Dropbox's datastore API. It handles serializing and deserializing objects to and from the remote Dropbox datastore as well as handling pushing/pulling updates. BobbyTables supports .Net versions 2+, Silverlight 4+, Windows Phone 7.5+, and Windows store applications.\r\n\r\n### API & Usage\r\n\r\n#### DatastoreManager\r\n---------------------\r\nDatastoreManager Is used to list/add/remove datastore objects. To create a DatastoreManager, you will need a Dropbox OAuth 2.0 bearer token (You can get this by completing an OAuth 2.0 handshake - see https://www.dropbox.com/developers/core/docs#oa2-authorize for more details)\r\n\r\n```c#\r\nvar manager = new DatastoreManager(\"oauth_token\");\r\n\r\n// Getting or creating a datastore\r\nvar datastore = await manager.GetOrCreateAsync(\"test\");\r\n\r\n// Getting an existing datastore\r\nvar existing_datastore = await manager.GetAsync(\"default\");\r\n\r\n// Listing available datastores\r\nvar datastore_list = await manager.ListAsync();\r\nforeach (var ds in datastore_list) {\r\n  // ...\r\n}\r\n\r\n// Deleting a datastore\r\nawait manager.DeleteAsync(datastore);\r\n\r\n// Wait for up to a minute or for remote changes to occur, whichever comes first\r\nList<Datastore> changed = new List<Datastore>();\r\nif (await manager.AwaitDatastoreChangesAsync(changed)) {\r\n  // Any datastores that have remote changes applied are now in the changed list\r\n}\r\n\r\n// Wait for up to a minute or for a change to the list of datastores, whichever comes first\r\nif (await manager.AwaitListChangesAsync()) {\r\n  // calling manager.ListAsync will retrieve the changed list of datastores\r\n}\r\n```\r\n\r\n__NOTE__: All API methods that make remote requests to dropbox have a synchronous implementation, an async implementation that uses .net 4.5 async/await, and an async implementation that uses callback functions for when async/await is not supported.\r\n\r\n#### Datastore\r\n--------------\r\nA Datastore object Is analagous to a Database object in a typical ORM library. A Datastore contains Tables that can contain objects which can be added/updated/removed\r\n\r\n#### Inserting data into a datastore table\r\n```c#\r\nclass Appointment {\r\n  public string Id;\r\n  public DateTime Time;\r\n  public List<String> People = new List<string>();\r\n}\r\n\r\n...\r\n\r\n// pull in any remote changes and make sure we are up to date before\r\n// trying to apply our own local changes\r\nawait datastore.PullAsync();\r\n\r\n// get a reference to the appointments table\r\nvar table = datastore.GetTable<Appointment>(\"appointments\");\r\n\r\nvar new_appointment = new Appointment{ Id = \"1\", Time = DateTime.Now() };\r\nnew_appointment.People.Add(\"Jules\");\r\n\r\n// insert the object into the table. An Id can also be specified for this method\r\n// though because this object has a public string field called Id, this is worked\r\n// out automatically. Also note this method is not awaited as it is only recording\r\n// the change as pending locally. No changes have been pushed to Dropbox yet.\r\ntable.Insert(new_appointment);\r\n\r\n// now lets commit the pending insert and push it out to Dropbox\r\nif (await datastore.PushAsync()) {\r\n  // Yay! the changes were accepted\r\n} else {\r\n  // Oh no! a conflict occurred due to another user submitting a change concurrently.\r\n  // In this case we should revert our local changes, Pull in the latest changes and\r\n  // try again. NOTE: The Transaction feature can help make handling conflicts easier.\r\n}\r\n```\r\n\r\n#### Using transactions to handle conflicts\r\n```c#\r\n  // every operation inside the transaction will try to be pushed to Dropbox in a single\r\n  // commit. If anything fails, all changes are reverted, the latest changes are pulled\r\n  // from Dropbox, and the changes will be re-applied until the commit succeeds, or the \r\n  // max number of retries is exceeded\r\n  var success = await datastore.Transaction(()=> {\r\n    var table = datastore.GetTable<Appointment>(\"appointments\");\r\n    \r\n    var new_appointment = new Appointment{ Id = \"1\", Time = DateTime.Now() };\r\n    new_appointment.People.Add(\"Jules\");\r\n    \r\n    table.Insert(new_appointment);\r\n  }).PushAsync(); // can specify the number of retries as a parameter (default 1)\r\n  \r\n```\r\n\r\n#### Retrieving and updating existing data\r\n```c#\r\nvar table = datastore.GetTable<Appointment>(\"appointments\");\r\n\r\n// can search for objects using LINQ queries\r\nvar appointment = (from appt in table where t.Id == \"1\" select appt).SingleOrDefault();\r\n\r\n// or you can search using the Id directly\r\nappointment = table.Get(\"1\");\r\n\r\nappointment.People.Add(\"Vincent\");\r\nappointment.People.Add(\"Marcellus\");\r\n\r\n// now lets commit the pending update and push it out to Dropbox\r\nawait datastore.Transaction(()=> {\r\n  table.Update(appointment);\r\n}).PushAsync();\r\n```\r\n\r\n#### Saving and loading local datastore snapshots\r\n```c#\r\n// the local state of a datastore can be saved to a streamWriter. In this case we\r\n// are choosing to save the local snapshot to a file on disk\r\nusing (var stream = new FileStream(\"C:\\\\db.json\",FileMode.Create,FileAccess.Write)) {\r\n  using (StreamWriter writer = new StreamWriter(stream))\r\n  {\r\n  \tdatastore.Save(writer);\r\n  }\r\n}\r\n\r\n...\r\n\r\n// We can then reload the old state by loading this file\r\nusing (var stream = new FileStream(\"C:\\\\db.json\",FileMode.Open,FileAccess.Read)) {\r\n  using (StreamReader reader = new StreamReader(stream))\r\n  {\r\n  \tdatastore = manager.Load(reader);\r\n  }\r\n}\r\n```\r\n\r\n#### Detecting when remote changes occur\r\n```c#\r\nwhile (true) {\r\n  // Waits for up to a minute or for a change to occur, whichever happens first\r\n  if (await datastore.AwaitPullAsync()) {\r\n    // some remote changes occurred within the last minute and have been pulled in\r\n    // to the local snapshot\r\n  } else {\r\n    // no changes occurred\r\n  }\r\n}\r\n```\r\n\r\n#### The fiddly details of serializing objects\r\n\r\nOnly public fields, and public readable/writable properties can be serialized. If you want a field to be ignored from serialization tag it with the <code>[BobbyTables.Ignore]</code> attribute.\r\n\r\nThe dropbox datastore API only has support for the following datatypes so any objects that have fields with an unsupported datatype will not be able to be serialized or deserialized correctly (Lists or Arrays of any of the below data types are also supported)\r\n\r\n| Dropbox datatype | .NET datatype         |\r\n|------------------|:----------------------|\r\n| str              | string                |\r\n| number           | float,Single,double   |\r\n| int              | int/uint 16,32,64     |\r\n| timestamp        | DateTime              |\r\n| blob             | List\\<byte\\>, byte[]  |\r\n","google":"UA-3061240-17","note":"Don't delete this file! It's used internally to help with page regeneration."}